<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blue Square vs Red Squares - Space Edition</title>
  <style>
    body {
      background: navy;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: "Courier New", Courier, monospace;
      color: #0ff;
      text-align: center;
    }

    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: radial-gradient(circle at 50% 50%, #222, #000);
      border: 2px solid #0ff;
    }

    #scorePanel {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 16px;
      border: 2px solid #0ff;
      border-radius: 8px;
    }

    #scorePanel span {
      margin: 0 10px;
    }

    #startButton,
    #restartButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #0ff;
      color: #000;
      font-size: 1.2rem;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
    }

    #gameOver {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #f00;
      font-size: 2rem;
      display: none;
    }

    #highScores {
      position: absolute;
      top: 60%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #0ff;
      display: none;
    }

    #highScores h2 {
      margin: 0;
      padding: 0;
      font-size: 1.5rem;
      margin-bottom: 8px;
    }

    #highScores ol {
      padding-left: 20px;
      text-align: left;
      margin: 0;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="600" height="800"></canvas>

  <div id="scorePanel">
    <span>Score: <span id="score">0</span></span>
    <span>Lives: <span id="lives">3</span></span>
  </div>

  <button id="startButton">START</button>
  <button id="restartButton">RESTART</button>

  <div id="gameOver">GAME OVER</div>

  <div id="highScores">
    <h2>HIGH SCORES</h2>
    <ol id="scoresList"></ol>
  </div>

  <script>
    // --- CANVAS SETUP ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- UI ELEMENTS ---
    const startButton = document.getElementById('startButton');
    const restartButton = document.getElementById('restartButton');
    const scoreDisplay = document.getElementById('score');
    const livesDisplay = document.getElementById('lives');
    const gameOverText = document.getElementById('gameOver');
    const highScoresPanel = document.getElementById('highScores');
    const scoresList = document.getElementById('scoresList');

    // --- GAME STATE ---
    let animationId;
    let gameRunning = false;
    let score = 0;
    let lives = 3;

    // Difficulty factor that increases over time
    let difficulty = 1;

    // --- PLAYER (BLUE SQUARE) ---
    const player = {
      x: canvas.width / 2,
      y: canvas.height - 60,
      width: 40,
      height: 40,
      speed: 5,
      color: 'blue',
      vx: 0,
      vy: 0,
    };

    // --- ENTITIES ---
    let bullets = [];
    let enemies = [];
    let explosions = []; // placeholder for future expansions

    // --- BACKGROUND STARFIELD & ORBITS ---
    const starCount = 100;
    const stars = [];

    // We'll create a few orbiting objects to give a sense of cosmic motion
    const orbitCount = 5;
    const orbits = [];

    // Key handling
    const keys = {};
    document.addEventListener('keydown', (e) => {
      keys[e.code] = true;
    });
    document.addEventListener('keyup', (e) => {
      keys[e.code] = false;
    });

    // --- INITIALIZE BACKGROUND ---
    function initBackground() {
      // Initialize starfield
      for (let i = 0; i < starCount; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 1.5 + 0.5,
          speed: Math.random() * 0.5 + 0.2,
        });
      }

      // Initialize orbits around center of canvas
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      for (let i = 0; i < orbitCount; i++) {
        // random radius between 50 and 250
        const radius = 50 + Math.random() * 200;
        // random initial angle
        const angle = Math.random() * Math.PI * 2;
        // random orbit speed
        const orbitSpeed = 0.005 + Math.random() * 0.01;
        orbits.push({ centerX, centerY, radius, angle, orbitSpeed });
      }
    }

    function updateBackground() {
      // Move stars downward to create a starfield effect
      for (let i = 0; i < stars.length; i++) {
        stars[i].y += stars[i].speed;
        // If star goes off bottom, re-spawn at top
        if (stars[i].y > canvas.height) {
          stars[i].y = 0;
          stars[i].x = Math.random() * canvas.width;
        }
      }

      // Update orbits
      orbits.forEach((o) => {
        o.angle += o.orbitSpeed;
      });
    }

    function drawBackground() {
      // Draw stars
      ctx.save();
      ctx.fillStyle = 'white';
      stars.forEach((star) => {
        ctx.fillRect(star.x, star.y, star.size, star.size);
      });
      ctx.restore();

      // Draw orbiting objects
      ctx.save();
      ctx.fillStyle = 'yellow';
      orbits.forEach((o) => {
        const x = o.centerX + Math.cos(o.angle) * o.radius;
        const y = o.centerY + Math.sin(o.angle) * o.radius;
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.restore();
    }

    // --- GAME RESET ---
    function resetGame() {
      score = 0;
      lives = 3;
      difficulty = 1; // reset difficulty
      scoreDisplay.textContent = score;
      livesDisplay.textContent = lives;
      bullets = [];
      enemies = [];
      explosions = [];
      player.x = canvas.width / 2;
      player.y = canvas.height - 60;
      player.vx = 0;
      player.vy = 0;
    }

    // --- ENEMY (RED SQUARE) SPAWN ---
    function spawnEnemy() {
      const size = 40;
      const xPos = Math.random() * (canvas.width - size);
      // Factor in difficulty to make them faster over time
      enemies.push({
        x: xPos,
        y: -size,
        width: size,
        height: size,
        speed: (2 + Math.random() * 1.5) * difficulty,
        color: 'red',
      });
    }

    // --- DRAW PLAYER (BLUE SQUARE) ---
    function drawPlayer() {
      ctx.save();
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.width, player.height);
      ctx.restore();
    }

    // --- UPDATE PLAYER ---
    function updatePlayer() {
      if (keys['ArrowLeft'] || keys['KeyA']) {
        player.x -= player.speed;
      }
      if (keys['ArrowRight'] || keys['KeyD']) {
        player.x += player.speed;
      }
      if (keys['ArrowUp'] || keys['KeyW']) {
        player.y -= player.speed;
      }
      if (keys['ArrowDown'] || keys['KeyS']) {
        player.y += player.speed;
      }

      // Keep player in bounds
      if (player.x < 0) player.x = 0;
      if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
      if (player.y < 0) player.y = 0;
      if (player.y + player.height > canvas.height) player.y = canvas.height - player.height;
    }

    // --- BULLETS ---
    function drawBullets() {
      ctx.save();
      ctx.fillStyle = '#0f0'; // green bullets
      bullets.forEach((bullet) => {
        ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
      });
      ctx.restore();
    }

    function updateBullets() {
      bullets.forEach((bullet) => {
        bullet.y -= bullet.speed;
      });
      // remove off-screen bullets
      bullets = bullets.filter((b) => b.y + b.height > 0);
    }

    function shoot() {
      // Fire a bullet
      bullets.push({
        x: player.x + player.width / 2 - 3,
        y: player.y,
        width: 6,
        height: 10,
        speed: 8,
      });
    }

    // --- ENEMIES ---
    function drawEnemies() {
      ctx.save();
      enemies.forEach((enemy) => {
        ctx.fillStyle = enemy.color;
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
      });
      ctx.restore();
    }

    function updateEnemies() {
      // Move the enemies downward
      enemies.forEach((enemy) => {
        enemy.y += enemy.speed;
      });

      // remove off-screen enemies
      enemies = enemies.filter((e) => e.y < canvas.height);
    }

    // --- COLLISIONS ---
    function checkCollisions() {
      // bullets vs enemies
      for (let b = bullets.length - 1; b >= 0; b--) {
        const bullet = bullets[b];
        for (let e = enemies.length - 1; e >= 0; e--) {
          const enemy = enemies[e];
          if (
            bullet.x < enemy.x + enemy.width &&
            bullet.x + bullet.width > enemy.x &&
            bullet.y < enemy.y + enemy.height &&
            bullet.height + bullet.y > enemy.y
          ) {
            // collision: bullet hits enemy
            score++;
            scoreDisplay.textContent = score;

            bullets.splice(b, 1); // remove bullet
            enemies.splice(e, 1); // remove enemy
            break;
          }
        }
      }

      // enemies vs player
      for (let e = enemies.length - 1; e >= 0; e--) {
        const enemy = enemies[e];
        if (
          player.x < enemy.x + enemy.width &&
          player.x + player.width > enemy.x &&
          player.y < enemy.y + enemy.height &&
          player.height + player.y > enemy.y
        ) {
          // collision: enemy hits player
          lives--;
          livesDisplay.textContent = lives;
          enemies.splice(e, 1);

          if (lives <= 0) {
            endGame();
          }
        }
      }
    }

    // --- EXPLOSIONS (PLACEHOLDER) ---
    function drawExplosions() {
      // not implemented
    }

    function updateExplosions() {
      // not implemented
    }

    // --- GAME LOOP ---
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Increase difficulty slowly each frame
      difficulty += 0.0001;

      updateBackground();
      drawBackground();

      updatePlayer();
      updateBullets();
      updateEnemies();
      updateExplosions();
      checkCollisions();

      drawPlayer();
      drawBullets();
      drawEnemies();
      drawExplosions();

      // Randomly spawn red squares
      if (Math.random() < 0.02) {
        spawnEnemy();
      }

      animationId = requestAnimationFrame(gameLoop);
    }

    // --- END GAME ---
    function endGame() {
      cancelAnimationFrame(animationId);
      gameRunning = false;
      gameOverText.style.display = 'block';
      restartButton.style.display = 'block';
      storeHighScore(score);
      displayHighScores();
    }

    // --- START GAME ---
    function startGame() {
      if (!gameRunning) {
        gameOverText.style.display = 'none';
        highScoresPanel.style.display = 'none';
        startButton.style.display = 'none';
        restartButton.style.display = 'none';
        resetGame();
        gameRunning = true;
        initBackground();
        gameLoop();
      }
    }

    // --- RESTART GAME ---
    function restartGame() {
      startGame();
    }

    // --- HIGH SCORES ---
    function storeHighScore(newScore) {
      let highScores = JSON.parse(localStorage.getItem('blueSquaresHighScores')) || [];
      highScores.push(newScore);
      highScores.sort((a, b) => b - a);
      highScores = highScores.slice(0, 5);
      localStorage.setItem('blueSquaresHighScores', JSON.stringify(highScores));
    }

    function displayHighScores() {
      let highScores = JSON.parse(localStorage.getItem('blueSquaresHighScores')) || [];
      scoresList.innerHTML = '';
      highScores.forEach((s, index) => {
        const li = document.createElement('li');
        li.textContent = `#${index + 1} Score: ${s}`;
        scoresList.appendChild(li);
      });
      highScoresPanel.style.display = 'block';
    }

    // --- SHOOTING EVENT ---
    document.addEventListener('keydown', (e) => {
      if ((e.code === 'Space' || e.code === 'KeyJ') && gameRunning) {
        shoot();
      }
    });

    // --- BUTTONS ---
    startButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', restartGame);
    restartButton.style.display = 'none';
  </script>
</body>
</html>
